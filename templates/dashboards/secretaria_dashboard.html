{% extends 'base.html' %}
{% load static %}

{% block title %}Secretaria - Visão Geral{% endblock %}

{% block content %}
<div class="layout-wrapper d-flex">
    {% include 'includes/sidebar.html' %}
    
    <div id="main-content" class="flex-grow-1 transition-all">
        <header class="header-modern sticky-top shadow-sm py-3 px-4">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-3">
                    <button class="btn btn-light d-md-none shadow-sm" id="sidebarToggle"><i class="fas fa-bars"></i></button>
                    <div>
                        <div class="header-breadcrumb"><i class="fas fa-th-large me-1"></i> Secretaria</div>
                        <h1 class="header-title mb-0">Visão Geral</h1>
                    </div>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <div class="header-profile-box d-flex align-items-center gap-3 cursor-pointer">
                        <div class="text-end d-none d-sm-block">
                            <p class="mb-0 fw-bold text-dark small">{{ secretaria.user.get_full_name|default:'Secretaria' }}</p>
                            <p class="mb-0 text-muted" style="font-size: 0.7rem;">Administrativo</p>
                        </div>
                        <div class="rounded-circle bg-white d-flex align-items-center justify-content-center shadow-sm" style="width: 38px; height: 38px; border: 2px solid var(--primary-color);">
                            <i class="fas fa-user-cog text-senai-red"></i>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container-fluid p-4">
            <div class="bg-white p-4 rounded-3 shadow-sm mb-4 border-start border-4 border-senai-red">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                    <div>
                        <h4 class="fw-bold text-dark mb-1">Bem-vindo(a) de volta!</h4>
                        <p class="text-muted mb-0 small">Resumo das atividades administrativas.</p>
                    </div>
                    <!-- Botão de emissão removido conforme solicitado -->
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-lg-4 col-md-6">
                    <div class="card p-3 border-0 shadow-sm h-100 bg-primary-subtle">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-primary text-uppercase small fw-bold mb-1">Total Alunos</h6>
                                <h2 class="mb-0 fw-bold text-dark">{{ total_alunos }}</h2>
                            </div>
                            <div class="bg-white p-3 rounded-circle text-primary shadow-sm"><i class="fas fa-user-graduate fa-lg"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="card p-3 border-0 shadow-sm h-100 bg-success-subtle">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-success text-uppercase small fw-bold mb-1">Matrículas Ativas</h6>
                                <h2 class="mb-0 fw-bold text-dark">{{ matriculas_ativas }}</h2>
                            </div>
                            <div class="bg-white p-3 rounded-circle text-success shadow-sm"><i class="fas fa-check-circle fa-lg"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="card p-3 border-0 shadow-sm h-100 bg-warning-subtle">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="text-warning text-uppercase small fw-bold mb-1">Turmas Ativas</h6>
                                <h2 class="mb-0 fw-bold text-dark">{{ total_turmas }}</h2>
                            </div>
                            <div class="bg-white p-3 rounded-circle text-warning shadow-sm"><i class="fas fa-chalkboard fa-lg"></i></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Atalhos Rápidos -->
            <h5 class="fw-bold text-dark mb-3">Acesso Rápido</h5>
            <div class="row g-3">
                <div class="col-md-3">
                    <a href="{% url 'gestao_alunos' %}" class="card text-decoration-none border-0 shadow-sm hover-shadow transition-all h-100">
                        <div class="card-body text-center p-4">
                            <div class="mb-3 text-primary"><i class="fas fa-users fa-2x"></i></div>
                            <h6 class="text-dark fw-bold mb-1">Gestão de Alunos</h6>
                            <small class="text-muted">Matrículas e cadastros</small>
                        </div>
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="{% url 'controle_financeiro' %}" class="card text-decoration-none border-0 shadow-sm hover-shadow transition-all h-100">
                        <div class="card-body text-center p-4">
                            <div class="mb-3 text-success"><i class="fas fa-dollar-sign fa-2x"></i></div>
                            <h6 class="text-dark fw-bold mb-1">Financeiro</h6>
                            <small class="text-muted">Pagamentos e boletos</small>
                        </div>
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="{% url 'gestao_documentos' %}" class="card text-decoration-none border-0 shadow-sm hover-shadow transition-all h-100">
                        <div class="card-body text-center p-4">
                            <div class="mb-3 text-danger"><i class="fas fa-file-alt fa-2x"></i></div>
                            <h6 class="text-dark fw-bold mb-1">Documentos</h6>
                            <small class="text-muted">Histórico e 2ª Via</small>
                        </div>
                    </a>
                </div>
                <div class="col-md-3">
                    <a href="#" class="card text-decoration-none border-0 shadow-sm hover-shadow transition-all h-100">
                        <div class="card-body text-center p-4">
                            <div class="mb-3 text-info"><i class="fas fa-envelope fa-2x"></i></div>
                            <h6 class="text-dark fw-bold mb-1">Comunicados</h6>
                            <small class="text-muted">Enviar avisos</small>
                        </div>
                    </a>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    .hover-shadow:hover { transform: translateY(-5px); box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important; }
    .transition-all { transition: all 0.3s ease; }
</style>

<div class="overlay"></div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/secretaria.js' %}"></script>
<script src="{% static 'js/coordenacao-comunicacao.js' %}"></script>
<!-- Modals para criação rápida (Aviso / Evento) disponíveis para secretaria -->
<div class="modal fade" id="modalAviso" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-light border-bottom">
                <h5 class="modal-title fw-bold text-dark" id="modalAvisoTitle">Novo Aviso</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form id="formAviso">
                    <div class="row g-3">
                        <div class="col-md-8">
                            <label class="form-label fw-bold">Título do Aviso *</label>
                            <input type="text" class="form-control" id="inputAvisoTitulo" placeholder="Digite o título" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Tipo *</label>
                            <select class="form-select" id="inputAvisoTipo" required>
                                <option value="">Selecionar...</option>
                                <option value="Urgente">Urgente</option>
                                <option value="Importante">Importante</option>
                                <option value="Geral">Geral</option>
                                <option value="Informativo">Informativo</option>
                            </select>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-bold">Conteúdo *</label>
                            <textarea class="form-control" id="inputAvisoConteudo" rows="4" placeholder="Digite o conteúdo do aviso" required></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-top">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-senai-red" id="btnSalvarAviso" onclick="salvarAviso()">Publicar Aviso</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalEvento" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-light border-bottom">
                <h5 class="modal-title fw-bold text-dark" id="modalEventoTitle">Novo Evento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form id="formEvento">
                    <div class="row g-3">
                        <div class="col-md-8">
                            <label class="form-label fw-bold">Nome do Evento *</label>
                            <input type="text" class="form-control" id="inputEventoTitulo" placeholder="Digite o nome do evento" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Data do Evento *</label>
                            <input type="date" class="form-control" id="inputEventoDataEvento" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Hora do Evento *</label>
                            <input type="time" class="form-control" id="inputEventoHoraEvento" required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-bold">Local do Evento *</label>
                            <input type="text" class="form-control" id="inputEventoLocal" placeholder="Digite o local do evento" required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label fw-bold">Descrição (opcional)</label>
                            <textarea class="form-control" id="inputEventoDescricao" rows="3" placeholder="Digite a descrição do evento (opcional)"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-top">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-senai-red" id="btnSalvarEvento" onclick="salvarEvento()">Criar Evento</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}